class Listener{constructor(e,t,n=!1){this.fn=e,this.context=t,this.once=!0===n||!1}}class EventEmitter{constructor(){this._events={},this._eventsCount=0}addListener(e,t,n,i=!1){if("function"!=typeof t)throw new TypeError("The listener must be a function");let s=new Listener(t,n||this,i);return this._events[e]?this._events[e].fn?this._events[e]=[this._events[e],s]:this._events[e].push(s):(this._events[e]=s,this._eventsCount++),this}clearEvent(e){0==--this._eventsCount?this._events={}:delete this._events[e]}get eventNames(){let e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)Object.prototype.hasOwnProperty.call(e,t)&&n.push(t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n}getListeners(e){let t=[],n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(let e=0;e<n.length;e++)t[e]=n[e].fn;return t}getListenerCount(e){let t=this._events[e];return t?t.fn?1:t.length:0}emit(e,t,n,i,s,r){if(!this._events[e])return!1;let o,a,l=this._events[e],c=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,i),!0;case 5:return l.fn.call(l.context,t,n,i,s),!0;case 6:return l.fn.call(l.context,t,n,i,s,r),!0}for(a=1,o=new Array(c-1);a<c;a++)o[a-1]=arguments[a];l.fn.apply(l.context,o)}else{let s,r=l.length;for(a=0;a<r;a++)switch(l[a].once&&this.removeListener(e,l[a].fn,void 0,!0),c){case 1:l[a].fn.call(l[a].context);break;case 2:l[a].fn.call(l[a].context,t);break;case 3:l[a].fn.call(l[a].context,t,n);break;case 4:l[a].fn.call(l[a].context,t,n,i);break;default:if(!o)for(s=1,o=new Array(c-1);s<c;s++)o[s-1]=arguments[s];l[a].fn.apply(l[a].context,o)}}return!0}on(e,t,n){return this.addListener(e,t,n,!1)}once(e,t,n){return this.addListener(e,t,n,!0)}removeListener(e,t,n,i){let s=[];if(!this._events[e])return this;if(!t)return this.clearEvent(e),this;let r=this._events[e];if(r.fn)r.fn!==t||i&&!r.once||n&&r.context!==n||this.clearEvent(e);else{for(let e=0,s=[],o=r.length;e<o;e++)(r[e].fn!==t||i&&!r[e].once||n&&r[e].context!==n)&&s.push(r[e]);s.length?this._events[e]=1===s.length?s[0]:s:this.clearEvent(e)}return this}removeAllListeners(e){return e?this._events[e]&&this.clearEvent(e):(this._events={},this._eventsCount=0),this}}export class VideoInput extends EventEmitter{constructor(e={}){super(),e.videoElement?this.videoElement=e.videoElement:this.videoElement=buildVideoElement(e.videoElementId),this.constraints=e.constraints?e.constraints:{video:!0},this.timeouts={}}destroy(){}async open(e={}){if(!navigator.mediaDevices)return Promise.reject("MediaDevices API not supported.");!1===e.visible&&(this.visible=!1);let t=null;t=await navigator.mediaDevices.getUserMedia(this.constraints),this.videoElement.srcObject=t,this.videoElement.play()}close(){this.videoElement&&this.videoElement.srcObject&&(this.videoElement.pause(),this.videoElement.srcObject.getTracks().forEach(e=>e.stop()),this.videoElement.srcObject=void 0,this.videoElement.src="")}async fadeIn(e=5e3){return this.cancelFade(),this.videoElement.style.transitionDuration=parseInt(e)+"ms",this.videoElement.style.opacity="1",new Promise(t=>{this.timeouts.fadeInTimeout=setTimeout(()=>{this.emit("fadeindone"),t()},parseInt(e))})}cancelFade(){clearTimeout(this.timeouts.fadeOutTimeout),clearTimeout(this.timeouts.fadeInTimeout),this.timeouts.fadeOutTimeout=null,this.timeouts.fadeInTimeout=null;let e=window.getComputedStyle(this.videoElement).getPropertyValue("opacity");this.videoElement.style.opacity=e,this.emit("fadecancelled")}async fadeOut(e=5e3){return this.cancelFade(),this.videoElement.style.transitionDuration=parseInt(e)+"ms",this.videoElement.style.opacity="0",new Promise(t=>{this.timeouts.fadeOutTimeout=setTimeout(()=>{this.emit("fadeoutdone"),t()},parseInt(e))})}get visible(){return this.videoElement.style.opacity>0}set visible(e){e?this.fadeIn(0):this.fadeOut(0)}get playing(){}photograph(){}}export async function getVideoInputs(){return navigator.mediaDevices?new Promise(e=>{navigator.mediaDevices.enumerateDevices().then(t=>{let n=t.filter(e=>"videoinput"===e.kind);n.map(e=>{let{name:t,vendorId:n,productId:i}=parseInfoFromLabel(e.label);return e.vendorId=n,e.productId=i,e.name=t,e}),e(n)})}):Promise.resolve([])}export function getSupportedConstraints(){return navigator.mediaDevices?navigator.mediaDevices.getSupportedConstraints():void 0}function parseInfoFromLabel(e){let[,t,n,i]=e.match(/(.+) \(([0-9a-f]+):([0-9a-f]+)\)/i);return{name:t,vendorId:n=parseInt("0x"+n,16),productId:i=parseInt("0x"+i,16)}}function buildVideoElement(e){let t=document.createElement("video");return e&&t.setAttribute("id",e),document.body.append(t),t}